config:
  rules:
    assert_valid_currencyCode:
      audit_code: rule_001
      sub_entity: transaction
      total_record_count_sql: >
        select processed_file_name,count(*), min(file_date)
        from `{project}.{dataset}.validated_transaction`
        group by processed_file_name
      enabled: true
      sql_expr: >
        select GENERATE_UUID() as event_id
        from `{project}.{dataset}.validated_transaction`
        where validation_reason like '%Invalid Currency_code.%' and processed_file_name = {file_name}

    assert_invalid_principal_amount:
      audit_code: rule_002
      sub_entity: transaction
      total_record_count_sql: >
        select processed_file_name,count(*), min(file_date)
        from `{project}.{dataset}.validated_transaction`
        group by processed_file_name
      enabled: true
      sql_expr: >
        select GENERATE_UUID() as event_id
        from `{project}.{dataset}.validated_transaction`
        where validation_reason like '%Invalid principal_amount.%' and processed_file_name = {file_name}

    assert_invalid_record_count:
      audit_code: rule_003
      sub_entity: file_metadata
      total_record_count_sql: >
        select distinct(processed_file_name),1 as count,file_date
        from `{project}.{dataset}.validated_transaction`
      enabled: true
      sql_expr: >
        select GENERATE_UUID() as event_id, count(*)
        from `{project}.{dataset}.validated_transaction`
        where validation_reason like '%Invalid record_count.%' and processed_file_name = {file_name}
        group by processed_file_name
